<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Union Contract Jurisdictions - Nebraska & Iowa</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
        }

        #header {
            background-color: #1a4d2e;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        #header h1 {
            margin-bottom: 5px;
            font-size: 24px;
        }

        #header p {
            font-size: 14px;
            opacity: 0.9;
        }

        #map {
            height: calc(100vh - 200px);
            width: 100%;
        }

        #legend {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: absolute;
            bottom: 30px;
            right: 10px;
            z-index: 1000;
            max-width: 350px;
        }

        #legend h3 {
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 2px solid #1a4d2e;
            padding-bottom: 5px;
        }

        .legend-section {
            margin-bottom: 15px;
        }

        .legend-section h4 {
            font-size: 13px;
            margin-bottom: 5px;
            color: #333;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 12px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            margin-right: 8px;
            border: 1px solid #666;
            border-radius: 3px;
        }

        .local-info {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
            padding-left: 38px;
        }

        /* Print styles */
        @media print {
            #header {
                padding: 10px;
            }

            #header h1 {
                font-size: 20px;
            }

            #map {
                height: 800px !important;
                page-break-inside: avoid;
            }

            #legend {
                position: relative;
                bottom: auto;
                right: auto;
                box-shadow: none;
                border: 1px solid #ccc;
                margin: 20px;
                page-break-inside: avoid;
            }

            .leaflet-control-zoom {
                display: none;
            }
        }

        .leaflet-popup-content {
            font-size: 14px;
        }

        .leaflet-popup-content h4 {
            margin-bottom: 8px;
            color: #1a4d2e;
        }

        .leaflet-popup-content p {
            margin: 4px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>Union Contract Jurisdictions</h1>
        <p>Carpenters LU 427 | Interior Systems LU 1306 | Millwright LU 1463</p>
    </div>

    <div id="map"></div>

    <div id="legend">
        <h3>Contract Jurisdictions</h3>
        
        <div class="legend-section">
            <h4>Carpenters LU 427</h4>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2E86AB;"></div>
                <span>Metro Agreement</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #A23B72;"></div>
                <span>Lincoln & Outstate Agreement</span>
            </div>
            <div class="local-info">10761 Virginia Plaza, Papillion NE 68128 | 402-571-2561</div>
        </div>

        <div class="legend-section">
            <h4>Interior Systems LU 1306</h4>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #F18F01;"></div>
                <span>LU 1306 Agreement</span>
            </div>
            <div class="local-info">10761 Virginia Plaza, Papillion NE 68128 | 402-571-2561</div>
        </div>

        <div class="legend-section">
            <h4>Millwright LU 1463</h4>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #6A994E;"></div>
                <span>LU 1463 Agreement</span>
            </div>
            <div class="local-info">10761 Virginia Plaza, Papillion NE 68128 | 402-571-2561</div>
        </div>
    </div>

    <script>
        // Initialize map centered on Nebraska/Iowa region
        const map = L.map('map').setView([41.5, -98.5], 7);

        // Add base map tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        // Define colors for each agreement
        const colors = {
            'LU427_Metro': '#2E86AB',
            'LU427_LincolnOutstate': '#A23B72',
            'LU1306': '#F18F01',
            'LU1463': '#6A994E'
        };

        // County jurisdiction data
        const jurisdictions = {
            // LU 427 Metro Agreement - Nebraska
            'Antelope, NE': 'LU427_Metro',
            'Boone, NE': 'LU427_Metro',
            'Burt, NE': 'LU427_Metro',
            'Butler, NE': 'LU427_Metro',
            'Cass, NE': 'LU427_Metro',
            'Colfax, NE': 'LU427_Metro',
            'Cuming, NE': 'LU427_Metro',
            'Dodge, NE': 'LU427_Metro',
            'Douglas, NE': 'LU427_Metro',
            'Knox, NE': 'LU427_Metro',
            'Madison, NE': 'LU427_Metro',
            'Merrick, NE': 'LU427_Metro',
            'Nance, NE': 'LU427_Metro',
            'Otoe, NE': 'LU427_Metro',
            'Pierce, NE': 'LU427_Metro',
            'Platte, NE': 'LU427_Metro',
            'Polk, NE': 'LU427_Metro',
            'Sarpy, NE': 'LU427_Metro',
            'Saunders, NE': 'LU427_Metro',
            'Stanton, NE': 'LU427_Metro',
            'Washington, NE': 'LU427_Metro',
            'Wayne, NE': 'LU427_Metro',
            
            // LU 427 Metro Agreement - Iowa
            'Audubon, IA': 'LU427_Metro',
            'Cass, IA': 'LU427_Metro',
            'Fremont, IA': 'LU427_Metro',
            'Harrison, IA': 'LU427_Metro',
            'Mills, IA': 'LU427_Metro',
            'Montgomery, IA': 'LU427_Metro',
            'Page, IA': 'LU427_Metro',
            'Pottawattamie, IA': 'LU427_Metro',
            'Shelby, IA': 'LU427_Metro',

            // LU 427 Lincoln and Outstate Agreement
            'Clay, NE': 'LU427_LincolnOutstate',
            'Fillmore, NE': 'LU427_LincolnOutstate',
            'Gage, NE': 'LU427_LincolnOutstate',
            'Hamilton, NE': 'LU427_LincolnOutstate',
            'Jefferson, NE': 'LU427_LincolnOutstate',
            'Johnson, NE': 'LU427_LincolnOutstate',
            'Lancaster, NE': 'LU427_LincolnOutstate',
            'Nemaha, NE': 'LU427_LincolnOutstate',
            'Nuckolls, NE': 'LU427_LincolnOutstate',
            'Pawnee, NE': 'LU427_LincolnOutstate',
            'Richardson, NE': 'LU427_LincolnOutstate',
            'Saline, NE': 'LU427_LincolnOutstate',
            'Seward, NE': 'LU427_LincolnOutstate',
            'Thayer, NE': 'LU427_LincolnOutstate',
            'York, NE': 'LU427_LincolnOutstate',
            'Adams, NE': 'LU427_LincolnOutstate',
            'Arthur, NE': 'LU427_LincolnOutstate',
            'Banner, NE': 'LU427_LincolnOutstate',
            'Blaine, NE': 'LU427_LincolnOutstate',
            'Box Butte, NE': 'LU427_LincolnOutstate',
            'Boyd, NE': 'LU427_LincolnOutstate',
            'Brown, NE': 'LU427_LincolnOutstate',
            'Buffalo, NE': 'LU427_LincolnOutstate',
            'Chase, NE': 'LU427_LincolnOutstate',
            'Cherry, NE': 'LU427_LincolnOutstate',
            'Cheyenne, NE': 'LU427_LincolnOutstate',
            'Custer, NE': 'LU427_LincolnOutstate',
            'Dawes, NE': 'LU427_LincolnOutstate',
            'Dawson, NE': 'LU427_LincolnOutstate',
            'Deuel, NE': 'LU427_LincolnOutstate',
            'Dundy, NE': 'LU427_LincolnOutstate',
            'Franklin, NE': 'LU427_LincolnOutstate',
            'Frontier, NE': 'LU427_LincolnOutstate',
            'Furnas, NE': 'LU427_LincolnOutstate',
            'Garden, NE': 'LU427_LincolnOutstate',
            'Garfield, NE': 'LU427_LincolnOutstate',
            'Gosper, NE': 'LU427_LincolnOutstate',
            'Grant, NE': 'LU427_LincolnOutstate',
            'Greeley, NE': 'LU427_LincolnOutstate',
            'Hall, NE': 'LU427_LincolnOutstate',
            'Harlan, NE': 'LU427_LincolnOutstate',
            'Hayes, NE': 'LU427_LincolnOutstate',
            'Hitchcock, NE': 'LU427_LincolnOutstate',
            'Holt, NE': 'LU427_LincolnOutstate',
            'Hooker, NE': 'LU427_LincolnOutstate',
            'Howard, NE': 'LU427_LincolnOutstate',
            'Kearney, NE': 'LU427_LincolnOutstate',
            'Keith, NE': 'LU427_LincolnOutstate',
            'Keya Paha, NE': 'LU427_LincolnOutstate',
            'Kimball, NE': 'LU427_LincolnOutstate',
            'Lincoln, NE': 'LU427_LincolnOutstate',
            'Logan, NE': 'LU427_LincolnOutstate',
            'Loup, NE': 'LU427_LincolnOutstate',
            'McPherson, NE': 'LU427_LincolnOutstate',
            'Morrill, NE': 'LU427_LincolnOutstate',
            'Perkins, NE': 'LU427_LincolnOutstate',
            'Phelps, NE': 'LU427_LincolnOutstate',
            'Red Willow, NE': 'LU427_LincolnOutstate',
            'Rock, NE': 'LU427_LincolnOutstate',
            'Scotts Bluff, NE': 'LU427_LincolnOutstate',
            'Sheridan, NE': 'LU427_LincolnOutstate',
            'Sherman, NE': 'LU427_LincolnOutstate',
            'Sioux, NE': 'LU427_LincolnOutstate',
            'Thomas, NE': 'LU427_LincolnOutstate',
            'Valley, NE': 'LU427_LincolnOutstate',
            'Webster, NE': 'LU427_LincolnOutstate',
            'Wheeler, NE': 'LU427_LincolnOutstate'
        };

        // LU 1306 covers entire Nebraska except Cedar, Dakota, Dixon, and Thurston
        // Plus the same Iowa counties as LU 427 Metro
        const lu1306Excluded = ['Cedar, NE', 'Dakota, NE', 'Dixon, NE', 'Thurston, NE'];

        // LU 1463 Iowa counties
        const lu1463IowaCcounties = [
            'Adair, IA', 'Adams, IA', 'Audubon, IA', 'Boone, IA', 'Buena Vista, IA',
            'Calhoun, IA', 'Carroll, IA', 'Cass, IA', 'Cherokee, IA', 'Clarke, IA',
            'Clay, IA', 'Crawford, IA', 'Dallas, IA', 'Decatur, IA', 'Dickinson, IA',
            'Emmet, IA', 'Fremont, IA', 'Greene, IA', 'Guthrie, IA', 'Hamilton, IA',
            'Hardin, IA', 'Harrison, IA', 'Humboldt, IA', 'Ida, IA', 'Jasper, IA',
            'Lucas, IA', 'Lyon, IA', 'Madison, IA', 'Marion, IA', 'Marshall, IA',
            'Mills, IA', 'Monona, IA', 'Montgomery, IA', "O'Brien, IA", 'Osceola, IA',
            'Page, IA', 'Palo Alto, IA', 'Plymouth, IA', 'Pocahontas, IA', 'Polk, IA',
            'Pottawattamie, IA', 'Poweshiek, IA', 'Ringgold, IA', 'Sac, IA', 'Shelby, IA',
            'Sioux, IA', 'Story, IA', 'Taylor, IA', 'Union, IA', 'Warren, IA',
            'Webster, IA', 'Woodbury, IA'
        ];

        // Load county boundaries - using reliable public sources
        loadCountyBoundaries();

        function loadCountyBoundaries() {
            console.log('Loading county boundaries...');
            
            // Load Nebraska counties
            fetch('https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json')
                .then(response => response.json())
                .then(data => {
                    console.log('County data loaded successfully');
                    processCountiesWithFIPS(data);
                })
                .catch(error => {
                    console.error('Error loading county data:', error);
                    loadAlternativeSource();
                });
        }

        function loadAlternativeSource() {
            console.log('Trying alternative data source...');
            
            // Alternative: Load from another reliable source
            Promise.all([
                fetch('https://eric.clst.org/assets/wiki/uploads/Stuff/gz_2010_us_050_00_5m.json')
                    .then(r => r.json()),
            ])
            .then(([countyData]) => {
                console.log('Alternative source loaded');
                processAlternativeCountyData(countyData);
            })
            .catch(err => {
                console.error('Alternative source failed:', err);
                // Last resort: show a message
                alert('Unable to load county boundaries. Please check your internet connection and refresh the page.');
            });
        }

        // FIPS code to county name mapping for our states
        const fipsToCounty = {
            // Nebraska FIPS codes (31xxx)
            '31001': 'Adams, NE', '31003': 'Antelope, NE', '31005': 'Arthur, NE', '31007': 'Banner, NE',
            '31009': 'Blaine, NE', '31011': 'Boone, NE', '31013': 'Box Butte, NE', '31015': 'Boyd, NE',
            '31017': 'Brown, NE', '31019': 'Buffalo, NE', '31021': 'Burt, NE', '31023': 'Butler, NE',
            '31025': 'Cass, NE', '31027': 'Cedar, NE', '31029': 'Chase, NE', '31031': 'Cherry, NE',
            '31033': 'Cheyenne, NE', '31035': 'Clay, NE', '31037': 'Colfax, NE', '31039': 'Cuming, NE',
            '31041': 'Custer, NE', '31043': 'Dakota, NE', '31045': 'Dawes, NE', '31047': 'Dawson, NE',
            '31049': 'Deuel, NE', '31051': 'Dixon, NE', '31053': 'Dodge, NE', '31055': 'Douglas, NE',
            '31057': 'Dundy, NE', '31059': 'Fillmore, NE', '31061': 'Franklin, NE', '31063': 'Frontier, NE',
            '31065': 'Furnas, NE', '31067': 'Gage, NE', '31069': 'Garden, NE', '31071': 'Garfield, NE',
            '31073': 'Gosper, NE', '31075': 'Grant, NE', '31077': 'Greeley, NE', '31079': 'Hall, NE',
            '31081': 'Hamilton, NE', '31083': 'Harlan, NE', '31085': 'Hayes, NE', '31087': 'Hitchcock, NE',
            '31089': 'Holt, NE', '31091': 'Hooker, NE', '31093': 'Howard, NE', '31095': 'Jefferson, NE',
            '31097': 'Johnson, NE', '31099': 'Kearney, NE', '31101': 'Keith, NE', '31103': 'Keya Paha, NE',
            '31105': 'Kimball, NE', '31107': 'Knox, NE', '31109': 'Lancaster, NE', '31111': 'Lincoln, NE',
            '31113': 'Logan, NE', '31115': 'Loup, NE', '31117': 'McPherson, NE', '31119': 'Madison, NE',
            '31121': 'Merrick, NE', '31123': 'Morrill, NE', '31125': 'Nance, NE', '31127': 'Nemaha, NE',
            '31129': 'Nuckolls, NE', '31131': 'Otoe, NE', '31133': 'Pawnee, NE', '31135': 'Perkins, NE',
            '31137': 'Phelps, NE', '31139': 'Pierce, NE', '31141': 'Platte, NE', '31143': 'Polk, NE',
            '31145': 'Red Willow, NE', '31147': 'Richardson, NE', '31149': 'Rock, NE', '31151': 'Saline, NE',
            '31153': 'Sarpy, NE', '31155': 'Saunders, NE', '31157': 'Scotts Bluff, NE', '31159': 'Seward, NE',
            '31161': 'Sheridan, NE', '31163': 'Sherman, NE', '31165': 'Sioux, NE', '31167': 'Stanton, NE',
            '31169': 'Thayer, NE', '31171': 'Thomas, NE', '31173': 'Thurston, NE', '31175': 'Valley, NE',
            '31177': 'Washington, NE', '31179': 'Wayne, NE', '31181': 'Webster, NE', '31183': 'Wheeler, NE',
            '31185': 'York, NE',
            
            // Iowa FIPS codes (19xxx)
            '19001': 'Adair, IA', '19003': 'Adams, IA', '19007': 'Audubon, IA', '19011': 'Boone, IA',
            '19021': 'Buena Vista, IA', '19025': 'Calhoun, IA', '19027': 'Carroll, IA', '19029': 'Cass, IA',
            '19035': 'Cherokee, IA', '19039': 'Clarke, IA', '19041': 'Clay, IA', '19047': 'Crawford, IA',
            '19049': 'Dallas, IA', '19051': 'Decatur, IA', '19059': 'Dickinson, IA', '19063': 'Emmet, IA',
            '19071': 'Fremont, IA', '19073': 'Greene, IA', '19077': 'Guthrie, IA', '19079': 'Hamilton, IA',
            '19083': 'Hardin, IA', '19085': 'Harrison, IA', '19091': 'Humboldt, IA', '19093': 'Ida, IA',
            '19099': 'Jasper, IA', '19117': 'Lucas, IA', '19119': 'Lyon, IA', '19121': 'Madison, IA',
            '19125': 'Marion, IA', '19127': 'Marshall, IA', '19129': 'Mills, IA', '19133': 'Monona, IA',
            '19137': 'Montgomery, IA', '19141': "O'Brien, IA", '19143': 'Osceola, IA', '19145': 'Page, IA',
            '19147': 'Palo Alto, IA', '19149': 'Plymouth, IA', '19151': 'Pocahontas, IA', '19153': 'Polk, IA',
            '19155': 'Pottawattamie, IA', '19157': 'Poweshiek, IA', '19159': 'Ringgold, IA', '19161': 'Sac, IA',
            '19165': 'Shelby, IA', '19167': 'Sioux, IA', '19169': 'Story, IA', '19173': 'Taylor, IA',
            '19175': 'Union, IA', '19181': 'Warren, IA', '19187': 'Webster, IA', '19193': 'Woodbury, IA',
            
            // South Dakota FIPS codes (46xxx)
            '46127': 'Union, SD'
        };

        function processCountiesWithFIPS(geoJsonData) {
            L.geoJSON(geoJsonData, {
                filter: function(feature) {
                    // Only show counties in NE (31), IA (19), or SD (46)
                    const fips = feature.id;
                    const stateCode = fips.substring(0, 2);
                    return ['31', '19', '46'].includes(stateCode);
                },
                style: function(feature) {
                    const fips = feature.id;
                    const countyKey = fipsToCounty[fips];
                    
                    if (!countyKey) {
                        return { fillColor: '#cccccc', weight: 1, opacity: 1, color: '#333', fillOpacity: 0.3 };
                    }
                    
                    let fillColor = '#cccccc';

                    // Check LU 427 jurisdictions first
                    if (jurisdictions[countyKey]) {
                        fillColor = colors[jurisdictions[countyKey]];
                    }
                    // Check LU 1306
                    else if (countyKey.endsWith(', NE') && !lu1306Excluded.includes(countyKey)) {
                        fillColor = colors.LU1306;
                    }
                    else if (['Audubon, IA', 'Cass, IA', 'Fremont, IA', 'Harrison, IA', 'Mills, IA', 'Montgomery, IA', 'Page, IA', 'Pottawattamie, IA', 'Shelby, IA'].includes(countyKey)) {
                        fillColor = colors.LU1306;
                    }
                    // Check LU 1463
                    else if (countyKey.endsWith(', NE')) {
                        fillColor = colors.LU1463;
                    }
                    else if (lu1463IowaCcounties.includes(countyKey)) {
                        fillColor = colors.LU1463;
                    }
                    else if (countyKey === 'Union, SD') {
                        fillColor = colors.LU1463;
                    }

                    return {
                        fillColor: fillColor,
                        weight: 1,
                        opacity: 1,
                        color: '#333',
                        fillOpacity: 0.6
                    };
                },
                onEachFeature: function(feature, layer) {
                    const fips = feature.id;
                    const countyKey = fipsToCounty[fips];
                    
                    if (!countyKey) return;
                    
                    const [countyName, state] = countyKey.split(', ');
                    
                    let agreementText = 'Not in jurisdiction';
                    let localInfo = '';

                    if (jurisdictions[countyKey] === 'LU427_Metro') {
                        agreementText = 'Carpenters LU 427 - Metro Agreement';
                        localInfo = '10761 Virginia Plaza, Papillion NE 68128<br>Phone: 402-571-2561';
                    } else if (jurisdictions[countyKey] === 'LU427_LincolnOutstate') {
                        agreementText = 'Carpenters LU 427 - Lincoln & Outstate Agreement';
                        localInfo = '10761 Virginia Plaza, Papillion NE 68128<br>Phone: 402-571-2561';
                    } else if ((countyKey.endsWith(', NE') && !lu1306Excluded.includes(countyKey)) || 
                               ['Audubon, IA', 'Cass, IA', 'Fremont, IA', 'Harrison, IA', 'Mills, IA', 'Montgomery, IA', 'Page, IA', 'Pottawattamie, IA', 'Shelby, IA'].includes(countyKey)) {
                        agreementText = 'Interior Systems LU 1306';
                        localInfo = '10761 Virginia Plaza, Papillion NE 68128<br>Phone: 402-571-2561';
                    } else if (countyKey.endsWith(', NE') || lu1463IowaCcounties.includes(countyKey) || countyKey === 'Union, SD') {
                        agreementText = 'Millwright LU 1463';
                        localInfo = '10761 Virginia Plaza, Papillion NE 68128<br>Phone: 402-571-2561';
                    }

                    layer.bindPopup(`
                        <h4>${countyName} County, ${state}</h4>
                        <p><strong>${agreementText}</strong></p>
                        <p>${localInfo}</p>
                    `);

                    layer.on({
                        mouseover: function(e) {
                            layer.setStyle({ weight: 3, fillOpacity: 0.8 });
                        },
                        mouseout: function(e) {
                            layer.setStyle({ weight: 1, fillOpacity: 0.6 });
                        }
                    });
                }
            }).addTo(map);
        }

        function processAlternativeCountyData(geoData) {
            // Process alternative format county data
            processGeoJsonCounties(geoData, null);
        }


        // Add print button (optional)
        const printControl = L.control({position: 'topright'});
        printControl.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'print-control');
            div.innerHTML = '<button onclick="window.print()" style="padding: 8px 12px; background: white; border: 2px solid #1a4d2e; border-radius: 4px; cursor: pointer; font-weight: bold; color: #1a4d2e;">üñ®Ô∏è Print Map</button>';
            return div;
        };
        printControl.addTo(map);
    </script>
</body>
</html>
